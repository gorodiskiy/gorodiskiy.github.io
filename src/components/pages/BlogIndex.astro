---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import { useTranslations, useTranslatedPath } from '../../i18n/utils';

interface Props {
	lang: 'uk' | 'ru';
}

const { lang } = Astro.props;
const t = useTranslations(lang);
const translatePath = useTranslatedPath(lang);

const posts = (await getCollection('blog', ({ id }) => {
	return id.startsWith(`${lang}/`);
})).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);
---

<BaseLayout title={`Blog | ${t('hero.title')}`}>
	<div class="blog-container">
		<h1 class="section-title">{t('nav.blog')}</h1>
		<div class="post-grid">
			{
				posts.map((post) => {
					const slug = post.slug.split('/').pop();
					return (
					<article class="post-card">
						<a href={translatePath(`/blog/${slug}/`)}>
							<span class="post-date">
								{post.data.pubDate.toLocaleDateString(lang === 'uk' ? 'uk-UA' : 'ru-RU', {
									year: 'numeric',
									month: 'long',
									day: 'numeric',
								})}
							</span>
							<h2 class="post-title">{post.data.title}</h2>
							<p class="post-description">{post.data.description}</p>
							<span class="read-more">{t('blog.read_more')} &rarr;</span>
						</a>
					</article>
					);
				})
			}
		</div>
	</div>
</BaseLayout>

<style>
	.section-title {
		font-size: 32px;
		font-weight: 700;
		margin-bottom: 40px;
		position: relative;
		padding-left: 20px;
	}
	.section-title::before {
		content: '';
		position: absolute;
		left: 0;
		top: 50%;
		transform: translateY(-50%);
		width: 10px;
		height: 30px;
		background-color: var(--primary-color);
		border-radius: 5px;
	}
	.post-grid {
		display: grid;
		gap: 30px;
	}
	.post-date {
		font-size: 14px;
		color: var(--text-muted);
		opacity: 0.6;
		display: block;
		margin-bottom: 10px;
	}
	.read-more {
		color: var(--primary-color);
		font-weight: 700;
		margin-top: 15px;
		display: inline-block;
	}
</style>
