---
import { getLangFromUrl, useTranslations, useTranslatedPath } from '../i18n/utils';

const today = new Date();
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const translatePath = useTranslatedPath(lang);

const pathname = new URL(Astro.request.url).pathname;
// Normalize pathname to handle root correctly with and without trailing slash
const currentPath = pathname.replace(/\/$/, "") || "/";
---
<aside class="sidebar">
    <div class="sidebar-header">
        <a href={translatePath('/')} class="logo">
            <span class="logo-icon">G</span>
            <span class="logo-text">GORODISKIY</span>
        </a>
    </div>
    
    <nav class="sidebar-nav">
        <ul>
            <li><a href={translatePath('/')} class={(currentPath === "/" || currentPath === "/ru") ? "active" : ""}><i class="icon-home"></i> {t('nav.home')}</a></li>
            <li><a href={translatePath('/blog/')} class={currentPath.includes("/blog") ? "active" : ""}><i class="icon-pencil"></i> {t('nav.blog')}</a></li>
        </ul>
    </nav>

    <div class="sidebar-footer">
        <div class="language-switcher">
            <a href={lang === 'uk' ? '/ru' + (pathname === '/' ? '' : pathname) : pathname.replace(/^\/ru/, '') || '/'} class="lang-link">
                {lang === 'uk' ? 'RU' : 'UA'} <i class="icon-refresh"></i>
            </a>
        </div>
        <p class="copyright">&copy; {today.getFullYear()}</p>
    </div>
</aside>

<style>
    /* Стили будут в global.css, но для структуры оставлю пустой блок или вынесу позже */
</style>
